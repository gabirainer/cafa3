<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">

	<g:include_script src="$pwd_enroll_google_auth_ui.jsdbx" />
	<link href="84f0346b87120300cfab6dd207cb0b72.cssdbx?" rel="stylesheet" type="text/css"/>
	
    <input type="hidden" name="user_id" value="${gs.getUserID()}" />
    <input type="hidden" name="verification_id" value="${jvar_verification_id}" /> 
	<input type="hidden" name="mandatory" value="${jvar_mandatory}" />   
	<input type="hidden" name="tab_index" value="${jvar_tab_index}" />  
	<input type="hidden" id="goog_auth_valid" name="goog_auth_valid" value="${SNC.MultifactorAuthUtil.isValidated()}" />  

  <script type="text/javascript">
    // When the page gets loaded, execute the event handler for on-load event.
    addLoadEvent(
      function() {
		console.log("executing google auth on load function");
        goog_auth_on_load('${jvar_form_id}');
      },
	  '${jvar_form_id}'
    );

    // When the page gets loaded, register the event hanlder for on-submit event for the form.
    addSubmitEvent(
        function() { 
            return goog_auth_on_submit('${jvar_form_id}');
        },
	    '${jvar_form_id}'   
    ); 
  </script>
	
	<style type="text/css">
		#btnRegenerate, #btnDisable {
			display: table;
			margin: 0 auto;
		}
		
		.pwd-auth-validate {
		    display: none;	
		}
		 a:link {
				color: #0077da;
			}
	</style>
	
	<g:requires name="styles/heisenberg/heisenberg_all.css" includes="true" />
	<div class="ga-outer-container" style="margin-left: 0;">
		<div class="ga-flex-container"> 
			<div class="ga-flex-content pwd-auth-validate">
				<label class="ga-label default-focus-outline" tabindex="0">${gs.getMessage('1. Download the Authenticator app for your mobile device')}</label>

				<ul>
					<li>
						<a class="navigation_link default-focus-outline" href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8" target="_blank">${gs.getMessage('Apple iTunes')}</a>
					</li>
					<li>
						<a class="navigation_link default-focus-outline" href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" target="_blank">${gs.getMessage('Google Play')}</a>
					</li>
					<li>
						<a class="navigation_link default-focus-outline" href="http://www.windowsphone.com/en-us/store/app/authenticator/e7994dbc-2336-4950-91ba-ca22d653759b" target="_blank">${gs.getMessage('Windows Store')}</a>
					</li>
				</ul>
			</div>

			<div class="ga-flex-content ga-flex-content-center pwd-auth-validate">
				<label class="ga-label default-focus-outline" tabindex="0">${gs.getMessage('2. Open the app and scan the QR code below to pair your mobile device')}</label>			
				<img id="imgCode" role="presentation"/>
				<label id="lblCode" class="ga-label default-focus-outline" tabindex="0"/>
			</div>

			<div class="ga-flex-content pwd-auth-validate">
				<label class="ga-label default-focus-outline" tabindex="0" for="txtResponse">
					${gs.getMessage('3. Enter the code generated by the Authenticator app below')}</label>
				<span class="modal-footer flex">
					<input id="txtResponse" class="col-sm-9 form-control pwd-form-control" type="text" placeholder="${gs.getMessage('6-digit code')}" name="txtResponse"  tabindex="0" style="padding-left: 9px !important;"/>
				</span>
				<span class="modal-footer flex">
					<button class="btn btn-primary btn-pwd-submit"  data-toggle="modal" id="btnValidate" 
							onclick="return validateResponse('${jvar_form_id}');" 
							aria-label="${gs.getMessage('Pair Device')}">${gs.getMessage('Pair Device')}</button>
				</span>
			</div>

			<!-- Above content is shown if user is not enrolled yet. Below is if they are already enrolled or MFA is disabled -->
			<div class="ga-flex-content" style="display:none;" id="tdSuccess">
				<button class="btn btn-default" id="btnRegenerate" onclick="resetCode();">${gs.getMessage('Generate a new QR code')}</button><br/>
				<button class="btn btn-default" id="btnDisable" onclick="disableSetup();">${gs.getMessage('Disable Multi-factor authentication')}</button><br/>
			</div>

			<div class="ga-flex-content" style="display:none;" id="tdEnable">
				<button class="btn btn-default" id="btnEnable" onclick="enableSetup();">${gs.getMessage('Enable Multi-factor authentication')}</button><br/>
			</div>
		</div>
	</div>
	
</j:jelly>